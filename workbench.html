<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ResBuilder</title>
    <link rel="shortcut icon" type="image/png" href="./images/logos/favicon.png" />
    <link rel="stylesheet" href="./css/styles.min.css" />
    <link rel="stylesheet" href="./libs/dragula-master/dist/dragula.css" />
    <link rel="stylesheet" href="./libs/dragula-master/dist/dragula.min.css" />
    <!--<link rel="stylesheet" href="./libs/tabmaster/tabstyle.css" />-->
    <!--<link rel="stylesheet" href="/path/to/leaflet.css" />-->
    <style>

        h1 {
            margin-top: 20px;
            margin-bottom: 20px;
            font-size: 2.5rem;
            color: #343a40;
        }

        .container {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 10px;
        }

        /* Make the parent container flexible */
        #left-container {
            display: flex;
            flex-direction: column; /* Stack content vertically */
            flex-grow: 1; /* Allow it to grow based on the content inside */
            width: 100%; /* Make sure it takes the full width of its parent */
            padding: 15px; /* Add padding for spacing */
            margin: 10px; /* Add margin around the container */
            background-color: #fff; /* Light background for readability */
            border: 1px solid #ddd; /* Border for better visibility */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow for a polished look */
            border-radius: 8px; /* Rounded corners for aesthetics */
            overflow: hidden; /* Prevent content overflow */
        }

        /* Ensure the scrollable zone is flexible */
        #scrollable-zone {
            max-height: 300px; /* Limit the height to 300px and enable scrolling */
            overflow-y: auto; /* Enable vertical scrolling */
            overflow-x: hidden; /* Prevent horizontal overflow and wrap content */
            padding-right: 10px; /* Add space on the right */
            width: 100%; /* Allow it to grow to fill the parent width */
            padding: 10px; /* Add padding inside */
            background-color: #f9f9f9; /* Light background for better readability */
            border: 1px solid #ddd; /* Add a border around the zone */
            word-wrap: break-word; /* Ensure text wraps within the available width */
        }

        /* Ensure items inside the scrollable zone are displayed properly */
        #scrollable-zone .item {
            padding: 10px; /* Add padding inside each item */
            margin-bottom: 8px; /* Add space between items */
            background-color: #DBE6F2; /* Light background */
            color: #000; /* Dark text for contrast */
            border-radius: 4px; /* Rounded corners for aesthetics */
            text-align: left; /* Align text to the left */
            display: block; /* Ensure each item takes up the full width */
            width: 100%; /* Make sure items take up the full available width */
            word-wrap: break-word; /* Ensure long words wrap to the next line */
            overflow: hidden; /* Prevent content overflow */
            white-space: normal; /* Make sure the text wraps properly */
            line-height: 1.5; /* Improve readability */
        }

        .item {
            padding: 12px;
            margin: 8px 0;
            background-color: #DBE6F2;
            color: #000000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            white-space: normal;
            word-wrap: break-word;
            display: inline-block;
            word-break: break-all;
            line-height: 1.5;
        }

        .item:hover {
            background-color: #9ab4d0;
        }

        .tab-content {
            display: flex;
            flex-direction: column;
            min-height: 250px;
            overflow: hidden;
        }

        .tab-pane {
            flex-grow: 1;
            background: #f1f3f5;
            border-radius: 8px;
            padding: 15px;
            transition: opacity 0.05s ease-in-out;
        }

        .tab-pane.show {
            opacity: 1;
        }

        .nav-tabs .nav-link {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px 15px;
            margin: 0 2px;
        }

        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: #ffffff;
            border-color: #007bff;
        }

        .modal-content {
            border-radius: 8px;
        }

        .modal-header, .modal-body, .modal-footer {
            border: none;
        }

        .modal-footer button {
            border-radius: 4px;
        }

        /* Flashing effect for invalid fields */
        .is-invalid {
            border-color: red !important;
            animation: flashBorder 0.5s ease-in-out infinite alternate;
        }

        @keyframes flashBorder {
            0% { border-color: red; }
            100% { border-color: transparent; }
        }

        .invalid-feedback {
            color: red;
            font-size: 0.9rem;
            margin-top: 5px;
            display: block;
        }

    </style>
</head>

<body onload="init()">
    <!--  Body Wrapper -->
    <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
         data-sidebar-position="fixed" data-header-position="fixed">
        <!-- Sidebar Start -->
        <aside class="left-sidebar">
            <!-- Sidebar scroll-->
            <div>
                <div class="brand-logo d-flex align-items-center justify-content-between">
                    <a href="./index.html" class="text-nowrap logo-img">
                        <img src="./images/logos/resbuilder_icon.png" width="180" alt="" />
                    </a>
                    <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
                        <i class="ti ti-x fs-8"></i>
                    </div>
                </div>
                <!-- Sidebar navigation-->
                <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
                    <ul id="sidebarnav">
                        <li class="nav-small-cap">
                            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                            <span class="hide-menu">Home</span>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./index.html" aria-expanded="true">
                                <span>
                                    <i class="ti ti-chart-infographic"></i>
                                </span>
                                <span class="hide-menu">Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./workbench.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-article"></i>
                                </span>
                                <span class="hide-menu">Workbench</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./authentication-login.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-message-circle"></i>
                                </span>
                                <span class="hide-menu">Chat</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./authentication-login.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-file-description"></i>
                                </span>
                                <span class="hide-menu">Support</span>
                            </a>
                        </li>
                        <!--<li class="nav-small-cap">
                            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                            <span class="hide-menu">UI COMPONENTS</span>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./ui-buttons.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-article"></i>
                                </span>
                                <span class="hide-menu">Buttons</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./ui-alerts.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-alert-circle"></i>
                                </span>
                                <span class="hide-menu">Alerts</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./ui-card.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-cards"></i>
                                </span>
                                <span class="hide-menu">Card</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./ui-forms.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-file-description"></i>
                                </span>
                                <span class="hide-menu">Forms</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./ui-typography.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-typography"></i>
                                </span>
                                <span class="hide-menu">Typography</span>
                            </a>
                        </li>-->
                        <li class="nav-small-cap">
                            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                            <span class="hide-menu">AUTH</span>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./authentication-login.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-login"></i>
                                </span>
                                <span class="hide-menu">Log out</span>
                            </a>
                        </li>
                        <!--<li class="sidebar-item">
                            <a class="sidebar-link" href="./authentication-register.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-user-plus"></i>
                                </span>
                                <span class="hide-menu">Register</span>
                            </a>
                        </li>
                        <li class="nav-small-cap">
                            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                            <span class="hide-menu">EXTRA</span>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./icon-tabler.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-mood-happy"></i>
                                </span>
                                <span class="hide-menu">Icons</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./sample-page.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-aperture"></i>
                                </span>
                                <span class="hide-menu">Sample Page</span>
                            </a>
                        </li>-->
                    </ul>
                    <!--<div class="unlimited-access hide-menu bg-light-primary position-relative mb-7 mt-5 rounded">
                      <div class="d-flex">
                        <div class="unlimited-access-title me-3">
                          <h6 class="fw-semibold fs-4 mb-6 text-dark w-85">Upgrade to pro</h6>
                          <a href="https://adminmart.com/product/modernize-bootstrap-5-admin-template/" target="_blank" class="btn btn-primary fs-2 fw-semibold lh-sm">Buy Pro</a>
                        </div>
                        <div class="unlimited-access-img">
                          <img src="./images/backgrounds/rocket.png" alt="" class="img-fluid">
                        </div>
                      </div>
                    </div>-->
                </nav>
                <!-- End Sidebar navigation -->
            </div>
            <!-- End Sidebar scroll-->
        </aside>
        <!--  Sidebar End -->
        <!--  Main wrapper -->
        <div class="body-wrapper">
            <!--  Header Start -->
            <header class="app-header">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <ul class="navbar-nav">
                        <li class="nav-item d-block d-xl-none">
                            <a class="nav-link sidebartoggler nav-icon-hover" id="headerCollapse" href="javascript:void(0)">
                                <i class="ti ti-menu-2"></i>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-icon-hover" href="javascript:void(0)">
                                <i class="ti ti-bell-ringing"></i>
                                <div class="notification bg-primary rounded-circle"></div>
                            </a>
                        </li>
                    </ul>
                    <div class="navbar-collapse justify-content-end px-0" id="navbarNav">
                        <ul class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
                            <li class="nav-item dropdown">
                                <a class="nav-link nav-icon-hover" href="javascript:void(0)" id="drop2" data-bs-toggle="dropdown"
                                   aria-expanded="false">
                                    <img src="./images/profile/user-1.jpg" alt="" width="35" height="35" class="rounded-circle">
                                </a>
                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animate-up" aria-labelledby="drop2">
                                    <div class="message-body">
                                        <a href="javascript:void(0)" class="d-flex align-items-center gap-2 dropdown-item">
                                            <i class="ti ti-user fs-6"></i>
                                            <p class="mb-0 fs-3">My Profile</p>
                                        </a>
                                        <a href="javascript:void(0)" class="d-flex align-items-center gap-2 dropdown-item">
                                            <i class="ti ti-mail fs-6"></i>
                                            <p class="mb-0 fs-3">My Account</p>
                                        </a>
                                        <a href="javascript:void(0)" class="d-flex align-items-center gap-2 dropdown-item">
                                            <i class="ti ti-list-check fs-6"></i>
                                            <p class="mb-0 fs-3">My Task</p>
                                        </a>
                                        <a href="./authentication-login.html" class="btn btn-outline-primary mx-3 mt-2 d-block">Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>
            <!--  Header End -->
            <div class="container-fluid">
                <!--  Row 1 -->
                <div class="row">
                    <div class="col-lg-11 d-flex align-items-strech">
                        <div class="card w-100">
                            <div class="card-body">
                                <div class="d-sm-flex d-block align-items-center justify-content-between mb-9">
                                    <div class="mb-3 mb-sm-0">
                                        <h6 class="card-title fw-semibold">Service Mapping</h6>
                                        <span class="fw-normal">Select and edit Entity and Service</span>
                                    </div>
                                    <div>
                                        <!-- First Dropdown: Filters options in the second dropdown -->
                                        <!-- Added "Please select" as the default option in the first dropdown -->
                                        <select id="firstDropdown" class="form-select mb-2">
                                            <option value="default">Please select</option> <!-- Default option -->
                                            <option value="bank">Bank of ResBuilder Ltd</option>
                                        </select>
                                    </div>
                                    <div>
                                        <!--<select class="form-select">
                                            <option value="1">Select service</option>
                                            <option value="2">Car Loan Service</option>
                                            <option value="3">Mortgage Loan Service</option>
                                            <option value="4">Commercial Loan Service</option>
                                            <option value="5">Corporate Loan Service</option>
                                            <option value="6">Business Loan Service</option>
                                            <option value="7">Domestic Payment Service Inbound</option>
                                            <option value="8">Domestic Payment Service Outbound</option>
                                            <option value="9">Debit Card Service</option>
                                            <option value="10">Credit Card Service</option>
                                            <option value="11">International Payment Service Inbound</option>
                                            <option value="12">International Payment Service Outbound</option>
                                        </select>-->
                                        <!-- Second Dropdown (Now Above Drop Zone 2, auto-updated based on firstDropdown) -->
                                        <!-- Added "Please select" as the default option in the second dropdown -->
                                        <select id="secondDropdown" class="form-select mb-2">
                                            <option value="default">Please select</option> <!-- Default option -->
                                            <!-- Will be dynamically updated based on firstDropdown -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4 d-flex align-items-stretch">
                        <div class="container card" id="left-container">
                            <!-- Search box for filtering items -->
                            <div class="mb-3">
                                <input type="text" id="searchBox" class="form-control" placeholder="Search...">
                            </div>
                            <!-- Scrollable container for items -->
                            <div class="scrollable-zone border p-3" id="scrollable-zone">
                                
                            </div>
                        </div>
                    </div>
                    <!-- Bootstrap Tabs for Zone 2 -->
                        <div class="container card col-lg-7 align-items-stretch">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link active" id="people-tab" data-bs-toggle="tab" href="#people" role="tab" aria-controls="people" aria-selected="true">People</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="location-tab" data-bs-toggle="tab" href="#location" role="tab" aria-controls="location" aria-selected="false">Location</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="applications-tab" data-bs-toggle="tab" href="#applications" role="tab" aria-controls="applications" aria-selected="false">Applications</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="hardware-tab" data-bs-toggle="tab" href="#hardware" role="tab" aria-controls="hardware" aria-selected="false">Hardware</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="suppliers-tab" data-bs-toggle="tab" href="#suppliers" role="tab" aria-controls="suppliers" aria-selected="false">Suppliers</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="data-tab" data-bs-toggle="tab" href="#data" role="tab" aria-controls="data" aria-selected="false">Data</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade show active" id="people" role="tabpanel" aria-labelledby="people-tab">
                                    <!-- This tab-pane is now a drop zone -->
                                </div>
                                <div class="tab-pane fade" id="location" role="tabpanel" aria-labelledby="location-tab">
                                    <!-- This tab-pane is now a drop zone -->
                                </div>
                                <div class="tab-pane fade" id="applications" role="tabpanel" aria-labelledby="applications-tab">
                                    <!-- This tab-pane is now a drop zone -->
                                </div>
                                <div class="tab-pane fade" id="hardware" role="tabpanel" aria-labelledby="hardware-tab">
                                    <!-- This tab-pane is now a drop zone -->
                                </div>
                                <div class="tab-pane fade" id="suppliers" role="tabpanel" aria-labelledby="suppliers-tab">
                                    <!-- This tab-pane is now a drop zone -->
                                </div>
                                <div class="tab-pane fade" id="data" role="tabpanel" aria-labelledby="data-tab">
                                    <!-- This tab-pane is now a drop zone -->
                                </div>
                            </div>
                        </div>

                        <!-- Confirm Modal -->
                        <div class="modal fade" id="dropModal" tabindex="-1" aria-labelledby="dropModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="dropModalLabel">Confirm Action</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="modalForm">
                                            <div class="mb-3">
                                                <label for="wfhInput" class="form-label">How many WFH:</label>
                                                <input type="number" class="form-control" id="wfhInput" min="0">
                                            </div>
                                            <div class="mb-3">
                                                <label for="officeInput" class="form-label">How many work at office:</label>
                                                <input type="number" class="form-control" id="officeInput" min="0">
                                            </div>
                                            <div class="mb-3">
                                                <label for="exclusiveInput" class="form-label">What % of people in this Role work on this service exclusively:</label>
                                                <input type="number" class="form-control" id="exclusiveInput" min="0" max="100">
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" id="cancelBtn" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-primary" id="confirmBtn">Confirm</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Remove Modal -->
                        <div class="modal fade" id="removeModal" tabindex="-1" aria-labelledby="removeModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="removeModalLabel">Remove Item</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="removeModalForm">
                                            <div class="mb-3">
                                                <label for="removeWfhInput" class="form-label">How many WFH:</label>
                                                <input type="number" class="form-control" id="removeWfhInput" min="0">
                                            </div>
                                            <div class="mb-3">
                                                <label for="removeOfficeInput" class="form-label">How many work at office:</label>
                                                <input type="number" class="form-control" id="removeOfficeInput" min="0">
                                            </div>
                                            <div class="mb-3">
                                                <label for="removeExclusiveInput" class="form-label">What % of people in this Role work on this service exclusively:</label>
                                                <input type="number" class="form-control" id="removeExclusiveInput" min="0" max="100">
                                            </div>
                                        </form>
                                        <p>Do you want to remove this item?</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" id="removeCancelBtn" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-primary" id="saveChangesBtn">Save</button>
                                        <button type="button" class="btn btn-danger" id="removeConfirmBtn">Remove</button>
                                    </div>
                                </div>
                            </div>
                        </div>               
                </div>
            </div>
        </div>
    </div>
    <script src="./libs/jquery/dist/jquery.min.js"></script>
    <script src="./libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./js/sidebarmenu.js"></script>
    <script src="./js/app.min.js"></script>
    <script src="./libs/apexcharts/dist/apexcharts.min.js"></script>
    <script src="./libs/apexcharts/dist/apexcharts.esm.js"></script>
    <script src="./libs/simplebar/dist/simplebar.js"></script>
    <script src="./js/dashboard.js"></script>
    <script src="./libs/dragula-master/dist/dragula.js"></script>
    <script src="./libs/dragula-master/dist/dragula.min.js"></script>
    <!--<script src="./libs/tabmaster/tabscript.js"></script>-->
    <!--<script src="/path/to/leaflet.js"></script>-->
    <!--<script src="./js/wb_dragdrop.js"></script>-->
<script>
    $(document).ready(function () {
        // Define services for 'Bank of ResBuilder Ltd'
        const bankServices = [
            'Car Loan Service', 'Mortgage Loan Service', 'Commercial Loan Service', 'Corporate Loan Service',
            'Business Loan Service', 'Domestic Payment Service Inbound', 'Domestic Payment Service Outbound',
            'Debit Card Service', 'Credit Card Service', 'International Payment Service Inbound',
            'International Payment Service Outbound', 'Treasury Service', 'Vault Service', 'Cash & Coin Handling Service',
            'Clearing Service', 'Deposit Service', 'Cheques and Drafts Service'
        ];

        // Define items for each tab (Drop Zone 1)
        const peopleRoles = [
            'Applications Development Lead', 'Branch Team Manager', 'Business Analyst Lead', 'Business Manager to CEO',
            'Call Centre Manager', 'Call Centre Team Lead', 'CEO Office Lead', 'Compliance Lead', 'Crisis BCM Manager',
            'Data Governance Manager', 'Data Protection Lead', 'Dispute Resolution', 'Enterprise Architecture Manager',
            'Facilities Manager', 'Financial Analytics Team Lead', 'Financial Control Lead', 'Forecasting Team Lead',
            'GIA Lead', 'Head of AIS', 'Head of Compliance', 'Head of Dispute Resolution', 'Head of Financial Analytics',
            'Head of Financial Control', 'Head of Financial Forecasting', 'Head of GIA', 'Head of HRM', 'Head of ITSCM',
            'Head of Marketing', 'Head of Operational Risk Management', 'Head of Supplier Management', 'Head of Talent Acquisition',
            'Head of Training & Development', 'HRM Lead', 'Info Sec Manager', 'Infrastructure Manager', 'Innovation Lead',
            'Marketing Strategies Lead', 'Operational Resilience Co-ordinator', 'Operational Resilience Manager',
            'Operational Risk Management Lead', 'Process Improvement Lead', 'Resilience Co-ordinator', 'Sales Director',
            'Sales Manager', 'Service Desk Manager', 'Software Applications Manager', 'Software Projects Lead',
            'Supplier Management Lead', 'Talent Lead', 'Training Dev Lead'
        ];

        const locationRoles = ['Campus', 'Factory', 'Head Office', 'Office', 'Data Centre', 'Supplier Site'];

        const applicationsRoles = [
            'Account Access', 'Account Finder', 'Account Protector', 'Adaptec', 'Adobe', 'AdonisBP', 'Archway', 'Bloomberg',
            'Branch Teller System', 'CCURE', 'ConFusion', 'Coupa', 'Dynamics 365 ERP', 'Epicor Kinetic', 'Euronext', 'Everbridge',
            'Fact24', 'Factiva', 'Genetec', 'GeoSpark', 'Helllios', 'IBM RADAR', 'Kechie ERP', 'Lexis Nexis', 'Microsoft Office 365',
            'Mitratech', 'NCCIS', 'NetApp', 'Oracle', 'Oracle Netsuite', 'PostGreSQL', 'PowerBI', 'Prologic', 'Protecht', 'PULSE',
            'QlikSense', 'QuikBooks', 'Refinitiv', 'S&P Global', 'Sage Accounts', 'Sage Business Cloud', 'Salesforce', 'SAP',
            'SAP ERP', 'Seerist', 'ServiceNow', 'SpiraPlan', 'SunMicro', 'SYSPRO', 'Tableau', 'Tradestation', 'Vault Keeping System',
            'VCC', 'Vi-Clarity', 'Workday', 'Xmatters'
        ];

        const hardwareRoles = [
            'Audio Visual Device 1', 'Audio Visual Device 2', 'Badge Printer', 'Badge Readers', 'Canon Printer Spec 2',
            'Data Room Desktop Spec 4', 'Data Room Environment Control Equipment', 'Data Room Mainframe', 'Data Room Redundant Power Source',
            'Data Room Router', 'Data Room Server', 'Data Room Switch', 'Data Room Telco Equipment', 'Desktop Dell i7 Spec 2',
            'Desktop Dell Xenon Spec 1', 'Desktop HP i5 Spec 3', 'HikVision CCTV System', 'HP Printer Spec 3', 'iPad Tablet Spec 1',
            'Kyocera Printer Spec 1', 'Laptop MS Surface i5 Spec 3', 'Laptop MS Surface i7 Spec 1', 'Laptop MS Surface i7 Spec 2',
            'Mobile Apple iPhone 14', 'Mobile Huawei One', 'Mobile Samsung Galaxy', 'Motorola Digital Radio Base Set',
            'Motorola Digital Radio 2 Way', 'Poly Headset Spec 1', 'Specialist Device 1', 'Specialist Device 2', 'Specialist Device 3',
            'Thin Client NUC', 'Yubi Key'
        ];

        const suppliersRoles = [
            'AA', 'Apple Pay', 'Aramark', 'AWS', 'Block', 'Bloomberg', 'Brinks Securicor', 'Broadcom', 'BSkyB', 'BT', 'Cisco', 'CME',
            'Combilift', 'CPL Resources', 'Euronext', 'Evolon Payment Solutions', 'Factiva', 'Fruit of the Loom', 'Google Cloud', 'Google Pay',
            'IBM', 'Iron Mountain', 'Mastercard', 'Meta', 'Microsoft Azure', 'Natwest', 'NetApp', 'ODM Surveyors', 'Oracle', 'Paypal',
            'Pryce Loss Assessors Ltd', 'Quikbooks', 'Refinitiv', 'Revologic', 'S&P Global', 'Salesforge', 'Securitas', 'Seerist', 'Square',
            'Stripe', 'Tableau', 'TCS', 'Three Ireland', 'Tradestation', 'VCC', 'Vi-Clarity', 'VISA', 'Vodafone UK', 'Wipro'
        ];

        const dataRoles = [
            'Customer Data', 'Employee Data', 'Financial Data', 'Forecasts', 'IoT', 'Mobility Data', 'Sales Data', 'Sensor', 'Social Media Data',
            'Survey or census Data', 'Web Data'
        ];

        const tabRoleMap = {
            people: peopleRoles,
            location: locationRoles,
            applications: applicationsRoles,
            hardware: hardwareRoles,
            suppliers: suppliersRoles,
            data: dataRoles
        };

        // Function to generate unique key for service + tab combination
        function generateStateKey(service, tab) {
            return `${service}_${tab}`;
        }

        // Function to load items into Drop Zone 1 based on tab and dropdown selection
        function loadDropZone1Items(selectedService, activeTab) {
            console.log("Loading items for service: " + selectedService + ", Tab: " + activeTab); // Debugging line

            $('#scrollable-zone').empty();

            // Restore saved state for the selected service and active tab
            const stateKey = generateStateKey(selectedService, activeTab);
            const savedState = JSON.parse(localStorage.getItem(stateKey)) || null;
            if (savedState) {
                const dropZone2ItemsText = savedState.dropZone2.flatMap(zone => zone.items.map(item => item.split('<br>')[0]));
                const remainingItems = tabRoleMap[activeTab].filter(role => !dropZone2ItemsText.includes(role));
                remainingItems.forEach(item => {
                    $('#scrollable-zone').append(`<div class="item" data-original="${item}">${item}</div>`);
                });
            } else {
                tabRoleMap[activeTab].forEach(item => {
                    $('#scrollable-zone').append(`<div class="item" data-original="${item}">${item}</div>`);
                });
            }

            sortDropZone1(); // Sort Drop Zone 1 items in ascending order
        }

        // Function to handle save state for the selected service
        function saveServiceState(service, tab) {
            const stateKey = generateStateKey(service, tab);
            const dropZone1Items = $('#scrollable-zone .item').map(function () {
                return $(this).text();
            }).get();

            const dropZone2Items = [];
            $('.tab-pane').each(function () {
                const zoneId = $(this).attr('id');
                const items = $(this).find('.item').map(function () {
                    return $(this).html();
                }).get();
                dropZone2Items.push({
                    zoneId,
                    items
                });
            });

            localStorage.setItem(stateKey, JSON.stringify({
                dropZone1: dropZone1Items,
                dropZone2: dropZone2Items
            }));
        }

        // Function to restore state for the selected service and tab
        function restoreServiceState(service, tab) {
            const stateKey = generateStateKey(service, tab);
            const savedState = JSON.parse(localStorage.getItem(stateKey)) || null;

            $('#scrollable-zone').empty();
            $('.tab-pane').empty();

            if (savedState) {
                const dropZone2ItemsText = savedState.dropZone2.flatMap(zone => zone.items.map(item => item.split('<br>')[0]));
                const remainingItems = tabRoleMap[tab].filter(role => !dropZone2ItemsText.includes(role));

                remainingItems.forEach(item => {
                    $('#scrollable-zone').append(`<div class="item" data-original="${item}">${item}</div>`);
                });

                savedState.dropZone2.forEach(zone => {
                    zone.items.forEach(itemContent => {
                        $(`#${zone.zoneId}`).append(`<div class="item" data-original="${itemContent.split('<br>')[0]}">${itemContent}</div>`);
                    });
                    sortDropZone2(zone.zoneId);
                });
            } else {
                tabRoleMap[tab].forEach(item => {
                    $('#scrollable-zone').append(`<div class="item" data-original="${item}">${item}</div>`);
                });
            }
        }

        // Function to handle tab change and update items
        function updateItemsOnTabChange() {
            const selectedService = $('#secondDropdown').val();
            const activeTab = $('.nav-tabs .active').attr('href').substring(1); // Get the current active tab id
            if (selectedService !== 'default') {
                loadDropZone1Items(selectedService, activeTab); // Load items for active tab
            }
        }

        // Handle Dropdown 1 change event
        $('#firstDropdown').on('change', function () {
            const selectedCategory = $(this).val();
            if (selectedCategory === 'default') {
                $('#secondDropdown').empty().append('<option value="default">Please select</option>');
                $('#scrollable-zone').empty();
                return;
            }

            if (selectedCategory === 'bank') {
                $('#secondDropdown').empty().append('<option value="default">Please select</option>');
                bankServices.forEach(service => {
                    $('#secondDropdown').append(`<option value="${service}">${service}</option>`);
                });
                $('#scrollable-zone').empty();
            }
        });

        // Handle Dropdown 2 change event
        $('#secondDropdown').on('change', function () {
            const selectedService = $(this).val();
            if (selectedService === 'default') {
                $('#scrollable-zone').empty();
                $('.tab-pane').empty();
                return;
            }

            // Save previous state and restore new state
            const previousService = $('#secondDropdown').data('previousService');
            const activeTab = $('.nav-tabs .active').attr('href').substring(1);
            if (previousService !== undefined) {
                saveServiceState(previousService, activeTab);
            }
            $('#secondDropdown').data('previousService', selectedService);
            updateItemsOnTabChange(); // Load the items for the active tab based on the selected service
        });

        // Initialize Dragula for each tab-pane
        const tabDropZones = ['#people', '#location', '#applications', '#hardware', '#suppliers', '#data'];

        const drake = dragula([document.getElementById('scrollable-zone')].concat(
            tabDropZones.map(id => document.querySelector(id))
        ));

        // Dragula drop handler
        drake.on('drop', function (el, target, source) {
            if (target && target.id !== 'scrollable-zone') {
                if (!$(el).data('original')) {
                    $(el).data('original', $(el).text());
                }
                const originalText = $(el).data('original');
                $('#wfhInput').val('');
                $('#officeInput').val('');
                $('#exclusiveInput').val('');

                $('#dropModal').modal('show');

                $('#confirmBtn').off('click').on('click', function () {
                    // Validation logic
                    let valid = true;
                    const wfh = $('#wfhInput').val();
                    const office = $('#officeInput').val();
                    const exclusive = $('#exclusiveInput').val();

                    // Remove previous error classes and messages
                    $('.form-control').removeClass('is-invalid');
                    $('.invalid-feedback').remove();

                    if (wfh === '' || wfh < 0) {
                        $('#wfhInput').addClass('is-invalid');
                        $('#wfhInput').after('<div class="invalid-feedback">Invalid entry</div>');
                        valid = false;
                    }
                    if (office === '' || office < 0) {
                        $('#officeInput').addClass('is-invalid');
                        $('#officeInput').after('<div class="invalid-feedback">Invalid entry</div>');
                        valid = false;
                    }
                    if (exclusive === '' || exclusive < 0 || exclusive > 100) {
                        $('#exclusiveInput').addClass('is-invalid');
                        $('#exclusiveInput').after('<div class="invalid-feedback">Invalid entry</div>');
                        valid = false;
                    }

                    if (valid) {
                        $('#dropModal').modal('hide');
                        $(el).html(`${originalText}<br>WFH = ${wfh}, WAO = ${office}, Exclusive % = ${exclusive}%`);
                        sortDropZone2(target.id);
                        const selectedService = $('#secondDropdown').val();
                        const activeTab = $('.nav-tabs .active').attr('href').substring(1); 
                        saveServiceState(selectedService, activeTab);
                    } else {
                        // Focus on the first invalid field
                        $('.is-invalid').first().focus();
                    }
                });

                $('#cancelBtn').off('click').on('click', function () {
                    $(el).appendTo($('#scrollable-zone'));
                    $('#dropModal').modal('hide');
                    sortDropZone1(); // Sort Drop Zone 1 after cancelling
                });
            } else if (source && target.id === 'scrollable-zone') {
                $(el).html($(el).data('original'));
                sortDropZone1();
                const selectedService = $('#secondDropdown').val();
                const activeTab = $('.nav-tabs .active').attr('href').substring(1);
                saveServiceState(selectedService, activeTab);
            }
        });

        // Handle remove/modify modal when clicking an item in Drop Zone 2
        $('.tab-pane').on('click', '.item', function () {
            const item = $(this); // The clicked item
            const values = extractValues(item.html()); // Extract values from item text

            // Set the input fields in the remove modal with the existing values
            $('#removeWfhInput').val(values.wfh || '');
            $('#removeOfficeInput').val(values.office || '');
            $('#removeExclusiveInput').val(values.exclusive || '');

            $('#removeModal').modal('show'); // Show the remove modal

            // Confirm button action for saving an item (Save Changes)
            $('#saveChangesBtn').off('click').on('click', function () {
                const wfh = $('#removeWfhInput').val();
                const office = $('#removeOfficeInput').val();
                const exclusive = $('#removeExclusiveInput').val();

                // Update the item in Drop Zone 2 with the modified values
                const originalText = $(item).data('original'); // Ensure the original text is used
                $(item).html(`${originalText}<br>WFH = ${wfh}, WAO = ${office}, Exclusive % = ${exclusive}%`);

                // Save the state after updating the item
                const selectedService = $('#secondDropdown').val();
                const activeTab = $('.nav-tabs .active').attr('href').substring(1);
                saveServiceState(selectedService, activeTab);

                $('#removeModal').modal('hide'); // Hide the remove modal
            });

            // Remove item and return to Drop Zone 1
            $('#removeConfirmBtn').off('click').on('click', function () {
                $('#removeModal').modal('hide'); // Close the modal first
                $(item).html($(item).data('original')).appendTo($('#scrollable-zone')); // Move back to Drop Zone 1
                sortDropZone1(); // Sort items in Drop Zone 1
                sortDropZone2(item.closest('.tab-pane').id); // Sort Drop Zone 2
                const selectedService = $('#secondDropdown').val();
                const activeTab = $('.nav-tabs .active').attr('href').substring(1);
                saveServiceState(selectedService, activeTab);
            });

            // Cancel button action
            $('#removeCancelBtn').off('click').on('click', function () {
                $('#removeModal').modal('hide'); // Just hide the modal on cancel
            });
        });

        $('#searchBox').on('keyup', function () {
            const searchTerm = $(this).val().toLowerCase();
            $('#scrollable-zone .item').each(function () {
                const text = $(this).text().toLowerCase();
                $(this).toggle(text.includes(searchTerm));
            });
        });

        function extractValues(text) {
            const wfhMatch = text.match(/WFH = (\d+)/);
            const officeMatch = text.match(/WAO = (\d+)/);
            const exclusiveMatch = text.match(/Exclusive % = (\d+)%/);

            return {
                wfh: wfhMatch ? wfhMatch[1] : '',
                office: officeMatch ? officeMatch[1] : '',
                exclusive: exclusiveMatch ? exclusiveMatch[1] : ''
            };
        }

        // Ensure sorting happens in Drop Zone 1
        function sortDropZone1() {
            const items = $('#scrollable-zone .item').get();
            items.sort((a, b) => $(a).text().localeCompare($(b).text()));
            $('#scrollable-zone').empty().append(items);
        }

        function sortDropZone2(zoneId) {
            const items = $(`#${zoneId} .item`).get();
            items.sort((a, b) => $(a).text().localeCompare($(b).text()));
            $(`#${zoneId}`).empty().append(items);
        }

        $(window).on('beforeunload', function () {
            const currentService = $('#secondDropdown').val();
            const activeTab = $('.nav-tabs .active').attr('href').substring(1);
            if (currentService !== 'default') {
                saveServiceState(currentService, activeTab);
            }
        });

        // Refined tab switching event
        $('a[data-bs-toggle="tab"]').on('shown.bs.tab', function () {
            const selectedService = $('#secondDropdown').val(); // Get the current selected service from Drop Down List 2
            const activeTab = $(this).attr('href').substring(1); // Get the ID of the newly activated tab

            if (selectedService !== 'default') {
                loadDropZone1Items(selectedService, activeTab); // Reload Drop Zone 1 items based on active tab and selected service
            }
        });

        $(document).ready(function () {
            const selectedService = $('#secondDropdown').val();
            const activeTab = $('.nav-tabs .active').attr('href').substring(1);
            if (selectedService !== 'default') {
                restoreServiceState(selectedService, activeTab);
            }
        });
    });
</script>

</body>

</html>